<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Gerenciamento de Pacientes</title>
    <h:outputStylesheet library="css" name="style.css"/>
</h:head>

<h:body>
    <div class="container">
        <h1>Gerenciamento de Pacientes</h1>
        
        <p:button value="Voltar ao Menu" outcome="index" icon="pi pi-arrow-left" 
                  styleClass="ui-button-secondary" style="margin-bottom: 20px;"/>
        
        <h:form id="formPaciente">
            <p:messages id="messages" showDetail="true" closable="true"/>
            
            <p:commandButton value="Novo Paciente" 
                             onclick="PF('dlgPaciente').show();" 
                             action="#{pacienteBean.novo}"
                             update="dialogForm"
                             icon="pi pi-plus"
                             styleClass="ui-button-success"
                             style="margin-bottom: 20px;"/>
            
            <p:panel header="Lista de Pacientes">
                <p:dataTable id="tabelaPacientes" 
                             value="#{pacienteBean.pacientes}" 
                             var="paciente"
                             paginator="true" 
                             rows="10"
                             emptyMessage="Nenhum paciente cadastrado">
                    
                    <p:column headerText="ID" style="width: 50px;">
                        <h:outputText value="#{paciente.id}"/>
                    </p:column>
                    
                    <p:column headerText="Nome" sortBy="#{paciente.nome}" filterBy="#{paciente.nome}">
                        <h:outputText value="#{paciente.nome}"/>
                    </p:column>
                    
                    <p:column headerText="CPF">
                        <h:outputText value="#{paciente.cpf}"/>
                    </p:column>
                    
                    <p:column headerText="Sexo">
                        <h:outputText value="#{paciente.sexo}"/>
                    </p:column>
                    
                    <p:column headerText="Data Nascimento">
                        <h:outputText value="#{paciente.dataNascimento}" converter="localDateConverter"/>
                    </p:column>
                    
                    <p:column headerText="Telefone">
                        <h:outputText value="#{paciente.telefone}"/>
                    </p:column>
                    
                    <p:column headerText="Ações" style="width: 150px; text-align: center;">
                        <p:commandButton icon="pi pi-pencil" 
                                         onclick="PF('dlgPaciente').show();"
                                         action="#{pacienteBean.editar(paciente)}"
                                         update="dialogForm"
                                         styleClass="ui-button-warning"
                                         title="Editar">
                            <f:setPropertyActionListener value="#{paciente}" 
                                                        target="#{pacienteBean.paciente}"/>
                        </p:commandButton>
                        
                        <p:commandButton icon="pi pi-trash" 
                                         action="#{pacienteBean.excluir(paciente)}"
                                         update="formPaciente:messages formPaciente:tabelaPacientes"
                                         styleClass="ui-button-danger"
                                         style="margin-left: 5px;"
                                         title="Excluir">
                            <p:confirm header="Confirmação" 
                                       message="Deseja realmente excluir este paciente?"
                                       icon="pi pi-exclamation-triangle"/>
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </p:panel>
            
            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check"/>
                <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times"/>
            </p:confirmDialog>
        </h:form>
        
        <p:dialog header="Cadastro de Paciente" widgetVar="dlgPaciente" modal="true" 
                  showEffect="fade" hideEffect="fade" resizable="false" width="800">
            <h:form id="dialogForm">
                <p:messages id="dialogMessages" showDetail="true" closable="true"/>
                
                <div class="p-fluid p-formgrid p-grid">
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="nome" value="Nome Completo:"/>
                        <p:inputText id="nome" value="#{pacienteBean.paciente.nome}" 
                                     required="true" requiredMessage="Nome é obrigatório"/>
                    </div>
                    
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="nomeSocial" value="Nome Social:"/>
                        <p:inputText id="nomeSocial" value="#{pacienteBean.paciente.nomeSocial}"/>
                    </div>
                    
                    <div class="p-field p-col-12 p-md-4">
                        <p:outputLabel for="sexo" value="Sexo:"/>
                        <p:selectOneMenu id="sexo" value="#{pacienteBean.paciente.sexo}" 
                                         required="true" requiredMessage="Sexo é obrigatório">
                            <f:selectItem itemLabel="Selecione..." itemValue=""/>
                            <f:selectItems value="#{pacienteBean.sexoOptions}"/>
                        </p:selectOneMenu>
                    </div>
                    
                    <div class="p-field p-col-12 p-md-4">
                        <p:outputLabel for="dataNascimento" value="Data de Nascimento:"/>
                        <p:calendar id="dataNascimento" value="#{pacienteBean.paciente.dataNascimento}" 
                                    pattern="dd/MM/yyyy" 
                                    required="true" requiredMessage="Data de nascimento é obrigatória"
                                    mask="true" converter="localDateConverter"/>
                    </div>
                    
                    <div class="p-field p-col-12 p-md-4">
                        <p:outputLabel for="cpf" value="CPF:"/>
                        <p:inputMask id="cpf" value="#{pacienteBean.paciente.cpf}" 
                                     mask="999.999.999-99"
                                     required="true" requiredMessage="CPF é obrigatório"/>
                    </div>
                    
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="nomeMae" value="Nome da Mãe:"/>
                        <p:inputText id="nomeMae" value="#{pacienteBean.paciente.nomeMae}"/>
                    </div>
                    
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="nomePai" value="Nome do Pai:"/>
                        <p:inputText id="nomePai" value="#{pacienteBean.paciente.nomePai}"/>
                    </div>
                    
                    <div class="p-field p-col-12 p-md-4">
                        <p:outputLabel for="rg" value="RG:"/>
                        <p:inputText id="rg" value="#{pacienteBean.paciente.rg}"/>
                    </div>
                    
                    <div class="p-field p-col-12 p-md-4">
                        <p:outputLabel for="cns" value="CNS (Cartão SUS):"/>
                        <p:inputText id="cns" value="#{pacienteBean.paciente.cns}"/>
                    </div>
                    
                    <div class="p-field p-col-12 p-md-4">
                        <p:outputLabel for="telefone" value="Telefone:"/>
                        <p:inputMask id="telefone" value="#{pacienteBean.paciente.telefone}" 
                                     mask="(99) 99999-9999"/>
                    </div>
                    
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="email" value="E-mail:"/>
                        <p:inputText id="email" value="#{pacienteBean.paciente.email}"/>
                    </div>
                    
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="endereco" value="Endereço:"/>
                        <p:inputText id="endereco" value="#{pacienteBean.paciente.endereco}"/>
                    </div>
                    
                    <div class="p-field p-col-12" style="margin-top: 20px;">
                        <p:commandButton value="Salvar" 
                                         action="#{pacienteBean.salvar}" 
                                         update="dialogMessages,:formPaciente:messages,:formPaciente:tabelaPacientes"
                                         oncomplete="if (args &amp;&amp; !args.validationFailed) PF('dlgPaciente').hide();"
                                         icon="pi pi-save"
                                         styleClass="ui-button-success"/>
                        
                        <p:commandButton value="Cancelar" 
                                         onclick="PF('dlgPaciente').hide();"
                                         type="button"
                                         icon="pi pi-times"
                                         styleClass="ui-button-secondary"
                                         style="margin-left: 10px;"/>
                    </div>
                </div>
            </h:form>
        </p:dialog>
    </div>
</h:body>
</html>
